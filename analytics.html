<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Kisaki Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="style.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
    /* ESTILO CYBER DASHBOARD */
    body { background-color: #0b1120; color: #e2e8f0; }

    .dashboard-header {
      padding: 20px;
      background: linear-gradient(to bottom, #1e293b, transparent);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    /* KPI CARDS (Tarjetas de m√©tricas superiores) */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 15px;
      margin-top: -20px;
    }

    .kpi-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      position: relative;
    }
    
    .kpi-title { font-size: 0.8em; color: #94a3b8; display: block; margin-bottom: 5px; }
    .kpi-value { font-size: 1.4em; font-weight: 700; color: #fff; }
    .kpi-trend { font-size: 0.75em; display: flex; align-items: center; gap: 4px; margin-top: 5px; }
    .trend-up { color: #ccf381; } /* Verde Ne√≥n */
    .trend-down { color: #ef4444; } /* Rojo */

    /* SECCIONES DE GR√ÅFICOS */
    .chart-container {
      margin: 15px;
      padding: 15px;
      background: #162032;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .section-title {
      font-size: 1em; font-weight: 600; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;
    }

    /* AI INSIGHT BOX */
    .ai-box {
      margin: 15px;
      padding: 15px;
      background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(147,51,234,0.1));
      border: 1px solid rgba(59,130,246,0.3);
      border-radius: 12px;
      position: relative;
    }
    .ai-header { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; color: #60a5fa; font-weight: bold; }
    
    /* MODALES Y PREMIUN */
    .blur-overlay { filter: blur(4px); pointer-events: none; user-select: none; }
    .premium-lock {
      position: absolute; top:0; left:0; width:100%; height:100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(11, 17, 32, 0.8); z-index: 10;
      border-radius: 16px;
    }
  </style>
</head>
<body>

  <div class="dashboard-header">
    <a href="index.html" style="color:white; text-decoration:none; display:flex; align-items:center; gap:10px; font-size:0.9em;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
      Volver
    </a>
    <h1 style="margin: 10px 0 0 0; font-size: 1.5em;">Panel de Control</h1>
    <div style="font-size:0.85em; color:#94a3b8;">Canal: <b style="color:#ccf381">@KisakiChannel</b></div>
  </div>

  <div class="kpi-grid">
    <div class="kpi-card">
      <span class="kpi-title">Suscriptores</span>
      <div class="kpi-value" id="kpiSubs">12,450</div>
      <div class="kpi-trend trend-up">‚ñ≤ +125 (Hoy)</div>
    </div>
    <div class="kpi-card">
      <span class="kpi-title">Engagement</span>
      <div class="kpi-value">8.4%</div>
      <div class="kpi-trend trend-down">‚ñº -0.2%</div>
    </div>
    <div class="kpi-card">
      <span class="kpi-title">Vistas Totales</span>
      <div class="kpi-value">45.2K</div>
      <div class="kpi-trend trend-up">‚ñ≤ +1.2K</div>
    </div>
    <div class="kpi-card">
      <span class="kpi-title">Ingresos (Est)</span>
      <div class="kpi-value">$340</div>
      <div class="kpi-trend trend-up">‚ñ≤ 15 Stars</div>
    </div>
  </div>

  <div class="ai-box">
    <div class="ai-header">
      <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path></svg>
      Kisaki AI Insight
    </div>
    <p style="font-size: 0.9em; line-height: 1.4; color: #cbd5e1; margin: 0;">
      Tu crecimiento ha aumentado un 12% esta semana. Los posts publicados a las <b>18:00</b> tienen un 40% m√°s de retenci√≥n. Te recomiendo subir contenido visual hoy.
    </p>
  </div>

  <div class="chart-container">
    <div class="section-title">
      Crecimiento de Audiencia
      <span style="font-size:0.7em; background:#334155; padding:2px 6px; border-radius:4px;">7 D√≠as</span>
    </div>
    <div id="growthChart"></div>
  </div>

  <div class="chart-container" style="position:relative;">
    <div class="section-title">Mejores Horarios</div>
    
    <div class="premium-lock">
      <div style="font-size:30px; margin-bottom:10px;">üîí</div>
      <div style="font-weight:bold; color:white;">Funci√≥n Premium</div>
      <button class="btn-telegram-cta" style="margin-top:10px; width:auto; padding: 8px 20px;">Desbloquear</button>
    </div>

    <div id="heatmapChart" class="blur-overlay"></div>
  </div>

  <script>
    // INICIALIZAR TELEGRAM
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- CONFIGURACI√ìN DE GR√ÅFICAS (APEXCHARTS) ---
    
    // 1. Gr√°fica de L√≠nea (Crecimiento)
    const growthOptions = {
      series: [{
        name: 'Subs',
        data: [12300, 12320, 12350, 12380, 12400, 12410, 12450]
      }],
      chart: {
        type: 'area',
        height: 200,
        toolbar: { show: false },
        background: 'transparent'
      },
      colors: ['#ccf381'], // Tu color verde marca
      stroke: { curve: 'smooth', width: 2 },
      fill: {
        type: 'gradient',
        gradient: {
          shadeIntensity: 1,
          opacityFrom: 0.4,
          opacityTo: 0.0,
          stops: [0, 90, 100]
        }
      },
      dataLabels: { enabled: false },
      theme: { mode: 'dark' }, // Modo oscuro autom√°tico
      grid: { borderColor: '#334155', strokeDashArray: 4 },
      xaxis: {
        categories: ['Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab', 'Dom'],
        labels: { style: { colors: '#94a3b8' } }
      },
      yaxis: { show: false }
    };

    const growthChart = new ApexCharts(document.querySelector("#growthChart"), growthOptions);
    growthChart.render();

    // 2. Gr√°fica Falsa para el fondo Premium (Heatmap)
    const heatmapOptions = {
      series: [
        { name: '10:00', data: [20, 30, 40, 50] },
        { name: '14:00', data: [10, 20, 60, 40] },
        { name: '18:00', data: [50, 60, 90, 80] }
      ],
      chart: { type: 'heatmap', height: 200, toolbar: { show: false }, background: 'transparent' },
      colors: ['#3b82f6'],
      theme: { mode: 'dark' },
      dataLabels: { enabled: false }
    };
    new ApexCharts(document.querySelector("#heatmapChart"), heatmapOptions).render();

  </script>
</body>
</html>