<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Kisaki Analytics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <link rel="stylesheet" href="style.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <style>
    /* ESTILOS ESPEC√çFICOS PARA ANALYTICS */
    body { background-color: #0f172a; color: #e2e8f0; padding-bottom: 40px; }

    /* Header transparente */
    .dashboard-header {
      padding: 20px;
      background: linear-gradient(to bottom, #1e293b, transparent);
      margin-bottom: 10px;
    }

    /* TARJETAS KPI (Cuadros de arriba) */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 0 15px;
      margin-bottom: 25px;
    }

    .kpi-card {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }
    
    .kpi-label { font-size: 0.75em; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
    .kpi-number { font-size: 1.4em; font-weight: 800; color: #fff; }
    .kpi-trend { font-size: 0.75em; margin-top: 5px; display: flex; align-items: center; gap: 4px; }
    
    .trend-up { color: #ccf381; }  /* Verde Marca */
    .trend-down { color: #f87171; } /* Rojo */

    /* CONTENEDORES DE GR√ÅFICAS */
    .chart-box {
      margin: 0 15px 20px 15px;
      background: #1e293b;
      border-radius: 16px;
      padding: 15px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .section-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;
    }
    .section-title { font-weight: 700; font-size: 1em; color: #fff; }

    /* CAJA INTELIGENTE (IA) */
    .ai-insight {
      margin: 0 15px 25px 15px;
      padding: 15px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(168, 85, 247, 0.1));
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 16px;
    }
    .ai-title { color: #60a5fa; font-size: 0.85em; font-weight: 700; display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
    
    /* BLOQUEO PREMIUM */
    .premium-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(4px);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 10;
      text-align: center;
    }
  </style>
</head>
<body>

  <div class="dashboard-header">
    <a href="index.html" style="color:#94a3b8; text-decoration:none; display:flex; align-items:center; gap:8px; font-size:0.9em; margin-bottom:10px;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
      Volver al Inicio
    </a>
    <div style="display:flex; justify-content:space-between; align-items:end;">
        <div>
            <h1 style="margin:0; font-size:1.8em;">Analytics</h1>
            <span style="font-size:0.85em; color:#64748b;">Panel de Control</span>
        </div>
        <div style="background:#334155; padding:6px 12px; border-radius:20px; font-size:0.8em; color:white;">7 D√≠as ‚ñº</div>
    </div>
  </div>

  <div class="kpi-grid">
    <div class="kpi-card">
      <span class="kpi-label">Suscriptores</span>
      <span class="kpi-number" id="valSubs">...</span>
      <span class="kpi-trend trend-up">‚ñ≤ 12% Semanal</span>
    </div>
    <div class="kpi-card">
      <span class="kpi-label">Vistas Totales</span>
      <span class="kpi-number" id="valViews">...</span>
      <span class="kpi-trend trend-up">‚ñ≤ 5.4% Hoy</span>
    </div>
    <div class="kpi-card">
      <span class="kpi-label">Engagement</span>
      <span class="kpi-number">8.4%</span>
      <span class="kpi-trend trend-down">‚ñº 0.2%</span>
    </div>
    <div class="kpi-card">
      <span class="kpi-label">Ingresos</span>
      <span class="kpi-number">üíé 150</span>
      <span class="kpi-trend trend-up">Stars</span>
    </div>
  </div>

  <div class="ai-insight">
    <div class="ai-title">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path></svg>
      Kisaki AI
    </div>
    <p style="margin:0; font-size:0.9em; color:#cbd5e1; line-height:1.4;">
      Tus publicaciones a las <b>18:00</b> tienen un 40% m√°s de retenci√≥n. Te recomiendo subir contenido visual hoy para mantener la racha de crecimiento.
    </p>
  </div>

  <div class="chart-box">
    <div class="section-header">
      <span class="section-title">Crecimiento de Audiencia</span>
    </div>
    <div id="growthChart"></div>
  </div>

  <div class="chart-box" style="height: 250px;">
    <div class="section-header">
      <span class="section-title">Mejores Horarios</span>
    </div>
    
    <div class="premium-overlay">
      <div style="font-size:30px; margin-bottom:10px;">üîí</div>
      <h3 style="margin:0; color:white;">Funci√≥n Premium</h3>
      <p style="font-size:0.85em; color:#94a3b8; margin:5px 0 15px 0;">Desbloquea el mapa de calor detallado.</p>
      <button style="background:#ccf381; color:#000; border:none; padding:8px 20px; border-radius:20px; font-weight:bold;">Mejorar Plan</button>
    </div>
    
    <div id="heatmapChart" style="filter: blur(5px);"></div>
  </div>

  <script>
    // 1. INICIALIZAR
    const tg = window.Telegram.WebApp;
    tg.expand();
    
    // Configuraci√≥n de Supabase
    const SUPABASE_URL = 'https://ndkupidhlauzroduvech.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_fSQ9uBUx_YTfxr2QL2-kfQ_pdE2cqHv'; 
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 2. CONFIGURACI√ìN DE GR√ÅFICAS (APEXCHARTS)
    
    // --- Gr√°fica de L√≠nea (Subs) ---
    const optionsGrowth = {
      series: [{
        name: 'Subs',
        data: [120, 132, 145, 150, 165, 170, 185] // Datos dummy iniciales
      }],
      chart: {
        type: 'area',
        height: 200,
        toolbar: { show: false },
        background: 'transparent',
        fontFamily: 'inherit'
      },
      colors: ['#ccf381'], /* Verde Kisaki */
      stroke: { curve: 'smooth', width: 2 },
      fill: {
        type: 'gradient',
        gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05, stops: [0, 90, 100] }
      },
      dataLabels: { enabled: false },
      theme: { mode: 'dark' },
      grid: { borderColor: '#334155', strokeDashArray: 4 },
      xaxis: {
        categories: ['L', 'M', 'M', 'J', 'V', 'S', 'D'],
        labels: { style: { colors: '#94a3b8' } },
        axisBorder: { show: false },
        axisTicks: { show: false }
      },
      yaxis: { show: false },
      tooltip: { theme: 'dark' }
    };

    const growthChart = new ApexCharts(document.querySelector("#growthChart"), optionsGrowth);
    growthChart.render();

    // --- Gr√°fica de Heatmap (Fondo Premium) ---
    const optionsHeat = {
      series: [
        { name: 'Lun', data: [10, 20, 50, 10] },
        { name: 'Mar', data: [15, 25, 60, 15] },
        { name: 'Mie', data: [20, 30, 80, 20] }
      ],
      chart: { type: 'heatmap', height: 200, toolbar: {show:false}, background:'transparent' },
      colors: ['#3b82f6'],
      theme: { mode: 'dark' },
      dataLabels: { enabled: false },
      xaxis: { labels: { show: false } }, yaxis: { show: false }
    };
    new ApexCharts(document.querySelector("#heatmapChart"), optionsHeat).render();

    // 3. CARGAR DATOS REALES (Simulado por ahora)
    async function loadStats() {
        // Aqu√≠ conectaremos con la tabla 'channel_stats'
        // Por ahora simulamos la carga para ver el efecto
        document.getElementById('valSubs').innerText = "1,240";
        document.getElementById('valViews').innerText = "45.2K";
    }

    loadStats();

  </script>
</body>
</html>
